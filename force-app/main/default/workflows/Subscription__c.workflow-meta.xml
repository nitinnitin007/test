<?xml version="1.0" encoding="UTF-8"?>
<Workflow xmlns="http://soap.sforce.com/2006/04/metadata">
    <rules>
        <fullName>Lapsed Product Customer</fullName>
        <actions>
            <name>Lapse_Product_Customer</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Lapse_Product_Customer_Lifecycle</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Lapse_Product_Customer_Project</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Lapse_Product_Customer_Status</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>AND(   ISCHANGED(Amount__c),   Amount__c = 0 )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-001xFxx</fullName>
        <actions>
            <name>Add_Product_Customer_Name</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-001xFxx
Populate Product Customer Name Reference
Populates Product Customer Name Reference to be used in search function on a lookup field.</description>
        <formula>ISBLANK( Product_Customer_Name_Reference__c )</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-002xFxx</fullName>
        <actions>
            <name>Update_Customer_Lifecycle_Stage_Previo</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-002xFxx
Store Prior Product Implementation Phase
Updates the Product Implementation Stage - Previous Field when Customer Lifecycle Stage field is changed</description>
        <formula>ISCHANGED(Customer_Lifecycle_Stage__c)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-003xxOx</fullName>
        <actions>
            <name>SendSubscriptionToDTE</name>
            <type>OutboundMessage</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-003xxOx
UpdateSubscriptionInDTE
Sends an outbound message in DTE to update Subscription</description>
        <formula>ISNEW() ||
ISCHANGED(Account__c) ||
ISCHANGED(Name) || 
ISCHANGED(Primary_Subscription__c) ||
ISCHANGED(Product_Line__c)||
ISCHANGED(Status__c)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-004xFxx</fullName>
        <actions>
            <name>Update_SRT_Status_Field</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-004xFxx
Subscription - Change SRT status on SRT Installed change
Updates SRT Status field when SRT Installed is changed and SRT Status is &quot;Not Installed&quot;</description>
        <formula>ISCHANGED(SRT_Installed__c) &amp;&amp; ISPICKVAL(SRT_Status__c, &apos;Not Installed&apos;)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-005xFxx</fullName>
        <actions>
            <name>Populate_Customer_Lifecycle_Stage</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-005xFxx
Customer Lifecycle Stage Green
Updates the customer lifecycle stage to  when they come back from a Lapsed state.</description>
        <formula>AND(
  ISCHANGED(Status__c),
  PRIORVALUE(Status__c)=&quot;Inactive&quot;,
  ISPICKVAL(Status__c,&quot;Active&quot;)
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-006Exxx</fullName>
        <actions>
            <name>Notification_CSM_Health_Regressed</name>
            <type>Alert</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-006Exxx
Notification: CSM Health Regressed
This is a notification for the CRM team when a Subscription Health regresses.</description>
        <formula>AND(
  OR(
    AND(
      OR(
        ISPICKVAL(CSM_Health_Rating__c,&quot;C - Needs Attention&quot;),
        ISPICKVAL(CSM_Health_Rating__c,&quot;D - At Risk&quot;),
        ISPICKVAL(CSM_Health_Rating__c,&quot;F - Lapsed&quot;)
      ),
      OR(
        CSM_Health_Rating_Previous__c=&quot;A - Good&quot;,
        CSM_Health_Rating_Previous__c=&quot;B - Minor Concerns&quot;,
        CSM_Health_Rating_Previous__c=&quot;E - No Knowledge&quot;,
        CSM_Health_Rating_Previous__c=&quot;New Subscription&quot;
      )
    ),
    AND(
      OR(
        ISPICKVAL(CSM_Health_Rating__c,&quot;D - At Risk&quot;),
        ISPICKVAL(CSM_Health_Rating__c,&quot;F - Lapsed&quot;)
      ),
      CSM_Health_Rating_Previous__c=&quot;C - Needs Attention&quot;
    ),
    AND(
      ISPICKVAL(CSM_Health_Rating__c,&quot;F - Lapsed&quot;),
      CSM_Health_Rating_Previous__c=&quot;D - At Risk&quot;
    ),
    AND(
      ISPICKVAL(CSM_Health_Rating__c,&quot;B - Minor Problems&quot;),
      CSM_Health_Rating_Previous__c=&quot;A - Good&quot;
    )
  )
)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-007xFxx</fullName>
        <actions>
            <name>Update_A_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-007xFxx
Update Health Rating: A</description>
        <formula>ISPICKVAL(CSM_Health_Rating__c,&quot;A - Good&quot;)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-008xFxx</fullName>
        <actions>
            <name>Update_B_C_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-008xFxx
Update Health Rating: B/C</description>
        <formula>OR(
   ISPICKVAL(CSM_Health_Rating__c,&quot;B - Minor Concerns&quot;),
   ISPICKVAL(CSM_Health_Rating__c,&quot;C - Needs Attention&quot;)
)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-009xFxx</fullName>
        <actions>
            <name>Update_E_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-009xFxx
Update Health Rating: E</description>
        <formula>ISPICKVAL(CSM_Health_Rating__c,&quot;E - No Knowledge&quot;)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-010xFxx</fullName>
        <actions>
            <name>Update_D_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-010xFxx
Update Health Rating: D</description>
        <formula>ISPICKVAL(CSM_Health_Rating__c,&quot;D - At Risk&quot;)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-011xFxx</fullName>
        <actions>
            <name>Update_F_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-011xFxx
Update Health Rating: F</description>
        <formula>ISPICKVAL(CSM_Health_Rating__c,&quot;F - Lapsed&quot;)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-012xFxx</fullName>
        <actions>
            <name>Update_New_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-012xFxx
Update Health Rating: New</description>
        <formula>ISPICKVAL(CSM_Health_Rating__c,&quot;New Subscription&quot;)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-013xFxx</fullName>
        <active>false</active>
        <description>Rule Code: PC-013xFxx
Health Still Accurate Checked
Old code - SUB-001xFxx
Updates the &quot;CSM Health Rating - Last Modified&quot; field whenever the &quot;Health Still Accurate&quot; box is checked. Also unchecked the &quot;Health Still Accurate&quot; box.</description>
        <formula>Health_Still_Accurate__c = TRUE</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-014xFxx</fullName>
        <active>false</active>
        <description>Rule Code: PC-014xFxx
Store Prior CSM Health Rating
old code - SUB-002xFxx
Updates the CSM Health Rating - Previous and CSM Health Rating - Last Modified fields</description>
        <formula>AND(
  ISCHANGED(CSM_Health_Rating__c), 
  LastModifiedById!=&quot;00550000002ngsR&quot;,
  LastModifiedById!=&quot;00550000004PGDf&quot;
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-015Exxx</fullName>
        <actions>
            <name>Notification_Health_Improved</name>
            <type>Alert</type>
        </actions>
        <active>false</active>
        <description>Rule Code: PC-015Exxx
Notification: CSM Health Improved
This is a notification for the CRM team when a Subscription Health improves.</description>
        <formula>AND(
  OR(
    AND(
      OR(
        ISPICKVAL(CSM_Health_Rating__c,&quot;A - Good&quot;),
        ISPICKVAL(CSM_Health_Rating__c,&quot;B - Minor Concerns&quot;)
      ),
      OR(
        CSM_Health_Rating_Previous__c=&quot;C - Needs Attention&quot;,
        CSM_Health_Rating_Previous__c=&quot;D - At Risk&quot;
      )
    ),
    AND(
      ISPICKVAL(CSM_Health_Rating__c,&quot;C - Needs Attention&quot;),
      CSM_Health_Rating_Previous__c=&quot;D - At Risk&quot;
    ),
    AND(
      ISPICKVAL(CSM_Health_Rating__c,&quot;B - Minor Concerns&quot;),
      CSM_Health_Rating_Previous__c=&quot;A - Good&quot;
    )
  )
)</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-016xFxx</fullName>
        <actions>
            <name>Update_Customer_Lifecycle_Stage</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-016xFxx
Customer Lifecycle Stage Lapsed
Updates the customer lifecycle stage to Lapsed</description>
        <formula>AND(
  ISCHANGED(CSM_Health_Rating__c),
  ISPICKVAL(CSM_Health_Rating__c,&quot;Black&quot;),
  ISCHANGED(Status__c),
  ISPICKVAL(Status__c,&quot;Inactive&quot;)
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-017xFxx</fullName>
        <actions>
            <name>update_FMS_Discussion_Completed_Date</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Subscription__c.FMS_Discussion_Completed__c</field>
            <operation>equals</operation>
            <value>True</value>
        </criteriaItems>
        <criteriaItems>
            <field>Subscription__c.FMS_Discussion_Completed_Date__c</field>
            <operation>equals</operation>
        </criteriaItems>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Rule Code%3A PC-018xFxx</fullName>
        <actions>
            <name>CSM_Health_Rating_Last_Modified_Update</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Uncheck_health_Still_accurate</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Rule Code: PC-018xFxx

Updates the &quot;CSM Health Rating – Last Modified&quot; when &quot;CSM Health Rating&quot; being updated.</description>
        <formula>OR(   ISCHANGED(CSM_Health_Rating__c),   ISCHANGED(Health_Still_Accurate__c)  )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Un-Lapsed Product Customer</fullName>
        <actions>
            <name>CSM_Health_Rating</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Customer_Lifecycle_Stage</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Product_Implementation_Phase</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Status</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>AND(   ISCHANGED(Amount__c),   PRIORVALUE(Amount__c)=0,   Amount__c &gt; 0 )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
</Workflow>
