<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>com_smartsheet__Link_Existing_Smartsheet</fullName>
    <availability>online</availability>
    <description>Link an existing Smartsheet to an account or opportunity.</description>
    <displayType>massActionButton</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Link Existing Smartsheet</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <requireRowSelection>false</requireRowSelection>
    <url>var recId = getRecordId(window.self.location.href);

    if (recId) {
        window.self.location.href = &quot;/apex/com_smartsheet__SmartsheetLink?id=&quot; + recId;
    } else {
        //alert user that no object id was found in the URL
        alert(&quot;Unable to recognize the id of the current object&quot;);
    }

    function getRecordId(url) {
        /*
         * Extract object at the end of the path
         * Examples:
         * https://na3.salesforce.com/0015000000ALZJP
         * https://na14.salesforce.com/001d000000UBdg2AAD/d?retURL=https%3A%2F%2Fnpe01.na14.visual.force.com%2Fapex%2FaccountViewOverride%3Fid%3D001d000000UGdg2%26sfdc.override%3D1&amp;nooverride=1
         * https://na9.salesforce.com/001E000000HC2wG
         */
        var rx = /https?:\/\/[^\/]+\.[^\/]+\/(.*\/)*([^\/]{15,18})(#|\/|$|\?)/;
        var match = rx.exec(url);

        if (match) {
            return match[2];
        }

        /*
         * Get it from id in query string
         * example: https://c.na9.visual.force.com/apex/VFAccount?id=001E000000Ac2wG&amp;sfdc.override=1
         */
        var rx = /(\?|\&amp;)id=([^&amp;]+)/
        var match = rx.exec(url);
        if(match){
            return match[2];
        }

        // no id found. return null
        return null;
    }</url>
</WebLink>
